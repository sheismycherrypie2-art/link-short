```
C:.
│   .editorconfig
│   .gitignore
│   application.properties
│   dependency-reduced-pom.xml
│   pom.xml
│   README.md
│   shortener.db
│
├───.github
│   └───workflows
│           ci.yml
│
├───.idea
│       .gitignore
│       compiler.xml
│       encodings.xml
│       jarRepositories.xml
│       misc.xml
│       workspace.xml
│
├───.mvn
├───src
│   ├───main
│   │   ├───java
│   │   │   └───org
│   │   │       └───example
│   │   │           └───shorter
│   │   │                   AppConfig.java
│   │   │                   ConfigLoader.java
│   │   │                   Link.java
│   │   │                   LinkRepository.java
│   │   │                   LinkService.java
│   │   │                   Main.java
│   │   │                   UserIdProvider.java
│   │   │
│   │   └───resources
│   └───test
│       └───java
│           └───org
│               └───example
│                   └───shoter
│                           ConfigLoaderTest.java
│                           LinkRepositoryTest.java
│                           LinkServiceTest.java
│
└───target
    │   link-short-1.0-SNAPSHOT.jar
    │   original-link-short-1.0-SNAPSHOT.jar
    │
    ├───classes
    │   └───org
    │       └───example
    │           └───shorter
    │                   AppConfig.class
    │                   ConfigLoader.class
    │                   Link.class
    │                   LinkRepository.class
    │                   LinkService.class
    │                   Main.class
    │                   UserIdProvider.class
    │
    ├───generated-sources
    │   └───annotations
    ├───generated-test-sources
    │   └───test-annotations
    ├───maven-archiver
    │       pom.properties
    │    
    ├───maven-status
    │   └───maven-compiler-plugin
    │       ├───compile
    │       │   └───default-compile
    │       │           createdFiles.lst
    │       │           inputFiles.lst
    │       │
    │       └───testCompile
    │           └───default-testCompile
    │                   createdFiles.lst
    │                   inputFiles.lst
    │
    ├───surefire-reports
    │       org.example.shorter.ConfigLoaderTest.txt
    │       org.example.shorter.LinkRepositoryTest.txt
    │       org.example.shorter.LinkServiceTest.txt
    │       TEST-org.example.shorter.ConfigLoaderTest.xml
    │       TEST-org.example.shorter.LinkRepositoryTest.xml
    │       TEST-org.example.shorter.LinkServiceTest.xml
    │
    └───test-classes
        └───org
            └───example
                └───shorter
                        ConfigLoaderTest.class
                        LinkRepositoryTest.class
                        LinkServiceTest.class
```

Проект имеет стандартную структуру Maven-приложения. В корне располагаются файлы сборки и конфигурации, включая pom.xml, который описывает зависимости, плагины и процесс сборки, файл application.properties с основными настройками сервиса, а также README.md, содержащий описание проекта и инструкции по использованию. Здесь же может находиться файл базы данных SQLite, используемый приложением для хранения сокращённых ссылок.
Исходный код приложения расположен в каталоге src/main/java и разделён по пакетам. В этом каталоге находятся классы, отвечающие за запуск консольного интерфейса, бизнес-логику сервиса сокращения ссылок, работу с базой данных, загрузку конфигурации и идентификацию пользователя. Каталог src/main/resources предназначен для хранения ресурсов приложения и может использоваться для конфигурационных файлов или других вспомогательных данных.
Модульные тесты размещены в каталоге src/test/java и проверяют корректность загрузки конфигурации, работу репозитория с базой данных и основную бизнес-логику сервиса. Это позволяет автоматически контролировать корректность работы приложения при изменениях кода.
Каталог target содержит результаты сборки проекта и формируется автоматически Maven. В нём находятся скомпилированные классы, отчёты о выполнении тестов и итоговый исполняемый JAR-файл, который используется для запуска приложения.
Для автоматической проверки качества кода и тестирования используется GitHub Actions. Конфигурация CI расположена в каталоге .github/workflows и обеспечивает автоматическую сборку и запуск тестов при каждом изменении кода в репозитории.

как пользоваться сервисом

Основное взаимодействие пользователя происходит через набор консольных команд, которые вводятся в терминале после запуска приложения. Каждая команда обрабатывается в главном цикле программы, реализованном в классе Main, и далее передаётся в слой бизнес-логики, представленный классом LinkService.

```
commands:
  create <url> [limit]
  open <code>
  list
  info <code>
  set-limit <code> \<limit\>
  delete <code>
  uuid
  help
  exit
config:
  ttl=PT24H, cleanup=PT30S, default.limit=5
examples:
  create https://www.google.com/ 3
  create "https://www.google.com/" 5
  open Ab3xK91Q
>
```

Команда create \<url\> [limit] используется для создания новой сокращённой ссылки. Пользователь указывает исходный URL и, при необходимости, лимит переходов. Если лимит не задан, используется значение по умолчанию, определённое в конфигурации приложения. При выполнении команды сервис проверяет корректность URL, создаёт уникальный короткий код и сохраняет ссылку в базе данных. В терминале пользователю выводится сгенерированный код, установленный лимит переходов и время жизни ссылки. Таким образом, команда create является основной точкой входа для добавления новых ссылок в систему.

```
create https://www.minecraft.net/ru-ru/store/minecraft-deluxe-collection-pc?tabs=%7B%22details%22%3A0%7D 5
code: dJm6187k
limit: 5
ttl: PT24H
>
```

Команда open \<code\> предназначена для использования сокращённой ссылки. При её выполнении сервис ищет ссылку по указанному коду, проверяет, не истёк ли срок её действия и не превышен ли лимит переходов. Если все условия соблюдены, количество кликов увеличивается на единицу. Учёт кликов выполняется атомарно, что гарантирует корректное поведение даже при нескольких последовательных обращениях. В зависимости от конфигурации приложение либо открывает исходный URL в браузере, либо выводит его в терминал. Если лимит переходов исчерпан, ссылка автоматически блокируется и повторное использование становится невозможным.

```
open dJm6187k
OPENED: https://www.minecraft.net/ru-ru/store/minecraft-deluxe-collection-pc?tabs=%7B%22details%22%3A0%7D
>
```

Команда list позволяет пользователю получить список всех созданных им ссылок. В выводе отображаются короткие коды, исходные URL, количество использованных и доступных переходов, а также статус активности ссылки. Эта команда используется для общего контроля состояния всех ссылок текущего пользователя.

```
list dJm6187k
-----
code: dJm6187k
url : https://www.minecraft.net/ru-ru/store/minecraft-deluxe-collection-pc?tabs=%7B%22details%22%3A0%7D
clicks: 1/5 active=true
expiresMs: 1768528370436
>
```

Команда info \<code\> предоставляет подробную информацию о конкретной ссылке. Она показывает исходный URL, количество переходов, статус активности и временные метки создания и истечения срока действия. Доступ к этой информации разрешён только владельцу ссылки, что обеспечивает базовый уровень разграничения доступа внутри сервиса.

```
info dJm6187k
code: dJm6187k
url : https://www.minecraft.net/ru-ru/store/minecraft-deluxe-collection-pc?tabs=%7B%22details%22%3A0%7D
clicks: 1/5
active: true
createdMs: 1768441970436
expiresMs: 1768528370436
>
```

Команда set-limit \<code\> \<limit\> используется для изменения максимального количества переходов по ссылке. При выполнении команды сервис проверяет права пользователя и, в случае успешной проверки, обновляет лимит в базе данных. Это позволяет гибко управлять уже созданными ссылками без необходимости создавать их заново.

```
set-limit dJm6187k 8
OK
> list dJm6187k
-----
code: dJm6187k
url : https://www.minecraft.net/ru-ru/store/minecraft-deluxe-collection-pc?tabs=%7B%22details%22%3A0%7D
clicks: 1/8 active=true
expiresMs: 1768528370436
>
```

Команда delete \<code\> предназначена для удаления ссылки. После её выполнения ссылка полностью удаляется из базы данных и становится недоступной для дальнейшего использования. Как и в случае других управляющих команд, операция доступна только владельцу ссылки.

```
delete dJm6187k
OK
> list
(empty)>
```

Команда uuid выводит уникальный идентификатор текущего пользователя. Этот идентификатор используется сервисом для привязки ссылок к конкретному пользователю и хранится локально, что позволяет сохранять состояние между запусками приложения.

```
uuid
319dd436-8e2c-44b1-9c4c-21a86b8281b1
>
```

Команды help и exit используются для получения справочной информации и завершения работы приложения соответственно. Команда help выводит список доступных команд и текущие параметры конфигурации, а команда exit завершает выполнение программы.

```
help
user: 319dd436-8e2c-44b1-9c4c-21a86b8281b1
commands:
  create <url> [limit]
  open <code>
  list
  info <code>
  set-limit <code> <limit>
  delete <code>
  uuid
  help
  exit
config:
  ttl=PT24H, cleanup=PT30S, default.limit=5
examples:
  create https://www.google.com/ 3
  create "https://www.google.com/" 5
  open Ab3xK91Q
> exit
0
```

Дополнительно в справочной информации отображаются активные параметры конфигурации, такие как время жизни ссылки (ttl), период очистки истёкших записей (cleanup) и лимит переходов по умолчанию (default.limit). Эти значения загружаются из файла конфигурации при запуске приложения и напрямую влияют на поведение сервиса.

```
config:
  ttl=PT24H, cleanup=PT30S, default.limit=5
```
 
Как протестировать.

Код тестируется с помощью модульных тестов на JUnit 5 и AssertJ. Тесты лежат в src/test/java и запускаются стандартными командами Maven. Чтобы прогнать тесты локально, в терминале из корня проекта выполняют mvn test. Maven соберёт проект и запустит все классы тестов, которые оканчиваются на *Test. Результаты выполнения можно посмотреть в папке target/surefire-reports, где сохраняются текстовые и XML-отчёты.
Для полного прогона, который соответствует тому, что запускается в CI, используют команду mvn clean verify. Она выполняет сборку, прогоняет тесты и дополнительно запускает проверку форматирования. Если форматирование нарушено — сборка упадёт, и это будет видно как локально, так и в GitHub Actions.
Проверяемые сценарии покрывают ключевую функциональность сервиса. ConfigLoaderTest подтверждает, что конфигурация корректно читается из файла и что при отсутствии файла берутся значения по умолчанию. LinkRepositoryTest проверяет работу с SQLite: вставку и поиск, удаление истёкших ссылок, а также атомарное списание кликов через метод consumeClick в LinkRepository, чтобы ссылка блокировалась строго на лимите. LinkServiceTest проверяет бизнес-логику: создание ссылок с валидным и невалидным URL, использование лимита по умолчанию, расходование кликов при open, блокировку после достижения лимита, а также запрет операций info/delete/set-limit для пользователя, который не является владельцем ссылки.
В репозитории также настроен CI (.github/workflows/ci.yml): при push и pull_request GitHub Actions автоматически выполняет mvn -q clean verify, то есть каждый коммит проверяется сборкой, тестами и форматированием.

документация по каждому модулю

Модуль конфигурации

Модуль конфигурации отвечает за загрузку и хранение параметров работы сервиса. Он представлен классами AppConfig и ConfigLoader, расположенными в пакете org.example.shorter.
Класс AppConfig является простым контейнером данных и хранит все параметры, необходимые для работы приложения: время жизни ссылки (TTL), период фоновой очистки, путь к файлу базы данных, лимит переходов по умолчанию, длину генерируемого короткого кода и флаг автоматического открытия браузера. Эти значения используются в различных частях приложения и передаются через конструкторы сервисов.
Загрузка конфигурации выполняется в классе ConfigLoader. В методе load происходит чтение файла application.properties с помощью стандартного класса Properties. Для каждого параметра предусмотрено значение по умолчанию, которое используется в случае отсутствия файла или конкретного ключа. Такой подход позволяет запускать приложение без обязательной предварительной настройки. Результатом работы ConfigLoader является объект AppConfig, который далее используется в классе Main.

Модуль модели данных

Модель данных представлена классом Link. Этот класс описывает сущность сокращённой ссылки и напрямую соответствует записи в таблице базы данных SQLite.
В классе Link хранятся идентификатор записи, UUID пользователя, короткий код ссылки, исходный URL, временные метки создания и истечения срока действия, лимит переходов, текущее количество кликов и флаг активности. Метод isActive используется для удобной проверки доступности ссылки на уровне бизнес-логики. Модель не содержит логики работы с базой данных и используется как переносчик данных между слоями приложения.

Модуль доступа к данным (Repository)

Работа с базой данных инкапсулирована в классе LinkRepository. Этот класс отвечает за все операции чтения и записи в SQLite и полностью изолирует SQL-логику от остального приложения.
При инициализации LinkRepository создаёт таблицу links, если она ещё не существует. Для подключения используется JDBC-драйвер SQLite. Репозиторий предоставляет методы для вставки новой ссылки, поиска по короткому коду, получения списка ссылок пользователя, удаления ссылок и обновления лимита переходов.
Ключевой частью этого модуля является метод consumeClick. Он реализует атомарное списание клика и выполняется внутри транзакции. Метод одновременно увеличивает счётчик кликов и деактивирует ссылку при достижении лимита. Такой подход гарантирует корректное поведение даже при быстром повторном использовании ссылки и предотвращает превышение лимита. После успешного обновления метод возвращает актуальное состояние ссылки.
Метод deleteExpired используется для фоновой очистки базы данных от ссылок с истёкшим сроком действия.

Модуль бизнес-логики

Основная логика сервиса сосредоточена в классе LinkService. Этот класс связывает пользовательские команды с операциями репозитория и реализует все проверки и правила работы сервиса.
Метод create отвечает за создание новой ссылки. Он проверяет корректность URL, применяет лимит переходов (явный или по умолчанию), рассчитывает срок действия ссылки и генерирует уникальный короткий код. Для генерации используется библиотека NanoID. В случае коллизии кода выполняется повторная попытка создания.
Метод open реализует сценарий использования ссылки. Он проверяет существование ссылки, срок её действия и доступность по лимиту, после чего вызывает атомарное списание клика через LinkRepository. В зависимости от конфигурации сервис либо открывает URL в браузере, либо выводит его в терминал. Метод также формирует стабильные сообщения для случаев истечения TTL или достижения лимита.
Методы list, info, setLimit и delete обеспечивают управление ссылками пользователя. Во всех этих методах реализована проверка владельца ссылки на основе UUID пользователя, что предотвращает доступ к чужим данным. Таким образом, LinkService является центральным элементом, обеспечивающим корректное и безопасное поведение приложения.

Модуль идентификации пользователя

Идентификация пользователя реализована в классе UserIdProvider. Этот модуль отвечает за получение или генерацию UUID пользователя и не требует ввода логина или пароля.
При первом запуске приложения UserIdProvider генерирует UUID и сохраняет его в файл в домашней директории пользователя. При последующих запусках UUID считывается из этого файла. Такой механизм позволяет привязывать ссылки к конкретному пользователю и сохранять состояние между запусками приложения.

Модуль CLI и запуска приложения

Класс Main является точкой входа в приложение и отвечает за взаимодействие с пользователем через терминал. В методе main происходит загрузка конфигурации, получение UUID пользователя, инициализация репозитория и сервиса, а также запуск фоновой задачи очистки.
Основной цикл программы считывает команды из стандартного ввода, разбирает аргументы и вызывает соответствующие методы LinkService. В этом же классе реализована справка (help), обработка ошибок и корректное завершение работы приложения. Метод startCleanup запускает отдельный daemon-поток, который периодически удаляет из базы данных ссылки с истёкшим сроком действия.

Модуль тестирования

Тестирование реализовано в виде модульных тестов, расположенных в src/test/java. Каждый тестовый класс соответствует отдельному модулю приложения.
ConfigLoaderTest проверяет корректность загрузки конфигурации и использование значений по умолчанию. LinkRepositoryTest проверяет работу с базой данных, включая атомарное списание кликов и удаление истёкших ссылок. LinkServiceTest покрывает бизнес-логику сервиса: создание ссылок, работу лимитов, TTL и проверки прав доступа. Тесты запускаются автоматически с помощью Maven и используются как локально, так и в CI.
